set -ex

LINK_CONTRACT=${LINK_CONTRACT:-"0xa36085F69e2889c224210F603D836748e7dC0088"}
ORACLE_CONTRACT=${ORACLE_CONTRACT:-"0x2f90A6D021db21e1B2A077c5a37B3C7E75D15b7e"}
JOB_ID=${JOB_ID:-"0x2a9c6b27a0dd48529b9d44dd8c48eb7300000000000000000000000000000000"}
ORACLE_PAYMENT=${ORACLE_PAYMENT:-1000000000000000000}
REGISTRY=${REGISTRY:-"0x648f679d855d2c9db97bb1ab14f2ecdf57d5ddb4"}
ATTR_KEY=${ATTR_KEY:-"0xf6a214f7a5fcda0c2cee9660b7fc29f5649e3c68aad48e20e950137c98913a68"}
FINGERPRINT=${FINGERPRINT:-"0x55ddb309968a41f674974c7016c576fddc28b88569238e021e4dcc750d6676e2"}
NFT_UPDATE=${NFT_UPDATE:-0xc63807020f7629F341D7042A9bF12d84355d4D8E}

dapp update
dapp --use solc:0.5.0 build --extract

# deploy mock contract if not set
if [[ -z "${NFT_UPDATE}" ]]; then
  echo "Deploying NFTUpdate contract"
  NFT_UPDATE=$(seth send --create out/NFTUpdate.bin 'NFTUpdate()')
  set +ex
  echo "-------------------------------------------------------------------------------"
  echo "NFTUpdate deployed to: $NFT_UPDATE"
  echo "-------------------------------------------------------------------------------"
fi


ORACLE=$(seth send --create out/NFTOracle.bin 'NFTOracle(address,address,bytes32,uint256,address,address,bytes32,bytes32)' $LINK_CONTRACT $ORACLE_CONTRACT $JOB_ID $ORACLE_PAYMENT $NFT_UPDATE $REGISTRY $ATTR_KEY $FINGERPRINT)

set +ex
echo "-------------------------------------------------------------------------------"
echo "NFTOracle deployed to: $ORACLE"
echo "-------------------------------------------------------------------------------"
